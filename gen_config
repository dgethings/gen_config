#!/usr/bin/env ruby
require 'erb'
require 'yaml'


unless ARGV[1]
  puts '', "Usage : ruby  #{$0}  <TEMPLATE_FILE> <YAML_FILE> [OUTPUT_FILENAME] [test]"
  puts '', "\t[OUTPUT_FILENAME] is optional, if not provided output will be to the screen"
  puts '', "\t[test] is optional, if set output will be the YAML configuration"
  system("pause")
  exit
end

template_file = ARGV[0]
yaml_file = ARGV[1]
output = ARGV[2]

config = YAML.load( File.read( yaml_file ) )

template = ERB.new( File.read( template_file ), nil, '-')

generated_config = template.result
if output
  if output == "test"
    puts YAML::dump(config)
  elsif  output != "test"
    File.open(output, 'w') do |f|
      f.puts generated_config
    end  
end
else
  puts generated_config
end


